<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Mini Royale — 2 Lanes, 3 Towers, Accurate Elixir</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
  :root{
    --arena: #cbe6ff;
    --lane: #a8d4ff;
    --accent: #2b7fb2;
    --danger: #d9534f;
    --panel: #ffffffdd;
    --muted: #555;
    --font: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
  }
  html,body{height:100%;margin:0;font-family:var(--font);background:linear-gradient(#b5e0ff,#7fc4ff);display:flex;align-items:center;justify-content:center;}
  #root{width:980px;max-width:98vw;padding:16px;}
  header{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px}
  h1{margin:0;font-size:20px;color:#063a5b}
  button{background:var(--accent);color:white;border:none;padding:8px 12px;border-radius:8px;cursor:pointer;font-weight:600}
  #gameWrap{display:flex;gap:10px}
  canvas{background:var(--arena);border-radius:14px;border:5px solid #2b7fb2;box-shadow:0 6px 16px rgba(0,0,0,0.2)}
  #uiCol{width:260px;display:flex;flex-direction:column;gap:10px}
  .panel{background:var(--panel);border-radius:10px;padding:10px;box-shadow:0 4px 14px rgba(0,0,0,0.08)}
  #elixirBar{height:18px;border-radius:10px;background:#e6f6ff;border:1px solid #bbe7f7;overflow:hidden}
  #elixirFill{height:100%;background:linear-gradient(#5fc7ff,#2b7fb2);width:0%}
  #hand{display:flex;gap:6px;justify-content:center}
  .card{width:72px;height:92px;border-radius:8px;background:white;border:2px solid #e3e7ea;box-shadow:0 3px 8px rgba(0,0,0,0.08);display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;user-select:none;transition:0.15s}
  .card:hover{transform:translateY(-4px);box-shadow:0 6px 14px rgba(0,0,0,0.12)}
  .card.selected{outline:3px solid #60b8ff;transform:translateY(-6px)}
  .card .name{font-size:12px;font-weight:700;margin-bottom:4px}
  .card .cost{font-weight:800;font-size:14px}
  #log{height:140px;overflow:auto;font-family:monospace;font-size:12px;background:#fff;padding:6px;border-radius:6px;border:1px solid #eee}
  #overlay{position:absolute;left:0;top:0;right:0;bottom:0;display:flex;align-items:center;justify-content:center;pointer-events:none}
  .modal{background:rgba(0,0,0,0.55);color:white;padding:26px;border-radius:12px;text-align:center;pointer-events:auto}
  footer{margin-top:10px;font-size:12px;color:var(--muted)}
</style>
</head>
<body>
<div id="root">
  <header>
    <h1>Mini Royale</h1>
    <button id="restartBtn">Restart</button>
  </header>
  <div id="gameWrap">
    <div style="position:relative">
      <canvas id="canvas" width="640" height="480"></canvas>
      <div id="overlay" style="width:640px;height:480px"></div>
    </div>
    <div id="uiCol">
      <div class="panel">
        <strong>Elixir</strong>
        <div id="elixirBar"><div id="elixirFill"></div></div>
      </div>
      <div class="panel">
        <strong>Your hand</strong>
        <div id="hand"></div>
      </div>
      <div class="panel">
        <strong>Battle log</strong>
        <div id="log"></div>
      </div>
    </div>
  </div>
  <footer>GitHub Pages–ready • Accurate elixir mechanics</footer>
</div>

<script>
/* --- Config --- */
const CONFIG = {
  canvasW:640,canvasH:480,
  laneY:{top:150,bottom:330},
  towerR:26,
  kingBackOffset:80,
  elixir:{start:5,max:10,interval:2800,doubleAfter:120000,doubleInterval:1400},
};
const CARDS=[
  {id:"knight",name:"Knight",cost:3,hp:160,dmg:46,speed:50,range:18,type:"melee"},
  {id:"archer",name:"Archer",cost:3,hp:80,dmg:28,speed:80,range:160,type:"ranged"},
  {id:"miniTank",name:"MiniTank",cost:5,hp:320,dmg:70,speed:30,range:20,type:"melee"},
  {id:"goblin",name:"Goblin",cost:2,hp:70,dmg:34,speed:110,range:14,type:"melee"},
  {id:"bomber",name:"Bomber",cost:4,hp:120,dmg:90,speed:36,range:22,type:"splash",splash:28},
  {id:"healer",name:"Healer",cost:4,hp:110,dmg:0,speed:40,range:48,type:"healer",heal:20}
];

/* --- State --- */
let state=null;
const canvas=document.getElementById("canvas");
const ctx=canvas.getContext("2d");
const handEl=document.getElementById("hand");
const elixirFill=document.getElementById("elixirFill");
const logEl=document.getElementById("log");
const overlay=document.getElementById("overlay");

/* --- Helpers --- */
function uid(){return Math.random().toString(36).slice(2,9)}
function clamp(v,a,b){return Math.max(a,Math.min(v,b))}

/* --- Init game --- */
function init(){
  state={
    elixir:CONFIG.elixir.start,elixirTick:0,time:0,
    playerDeck:CARDS.map(c=>({...c,uid:uid()})),cpuDeck:CARDS.map(c=>({...c,uid:uid()})),
    entities:[],preview:null,lastFrame:performance.now(),running:true,
    playerTowers:[],cpuTowers:[]
  };
  // towers
  const leftX=120,rightX=CONFIG.canvasW-120;
  state.playerTowers=[
    {x:leftX,y:CONFIG.laneY.top,hp:800,maxHp:800,owner:"player"},
    {x:leftX,y:CONFIG.laneY.bottom,hp:800,maxHp:800,owner:"player"},
    {x:leftX-CONFIG.kingBackOffset,y:CONFIG.canvasH/2,hp:1400,maxHp:1400,owner:"player",king:true}
  ];
  state.cpuTowers=[
    {x:rightX,y:CONFIG.laneY.top,hp:800,maxHp:800,owner:"cpu"},
    {x:rightX,y:CONFIG.laneY.bottom,hp:800,maxHp:800,owner:"cpu"},
    {x:rightX+CONFIG.kingBackOffset,y:CONFIG.canvasH/2,hp:1400,maxHp:1400,owner:"cpu",king:true}
  ];
  renderHand();logEl.innerHTML="";log("Game start!");
  requestAnimationFrame(loop);
}
document.getElementById("restartBtn").onclick=init;

/* --- Hand --- */
function renderHand(){
  handEl.innerHTML="";
  state.playerDeck.slice(0,3).forEach((c,i)=>{
    const d=document.createElement("div");
    d.className="card"+(state.selectedIndex===i?" selected":"");
    d.innerHTML=`<div class="name">${c.name}</div><div class="cost">${c.cost}</div>`;
    d.onclick=()=>{state.selectedIndex=i;renderHand()};
    handEl.appendChild(d);
  });
}

/* --- Placement --- */
canvas.addEventListener("mousemove",e=>{
  if(state.selectedIndex==null)return;
  const rect=canvas.getBoundingClientRect();
  const x=(e.clientX-rect.left)*(canvas.width/rect.width);
  const y=(e.clientY-rect.top)*(canvas.height/rect.height);
  if(x>canvas.width/2)return; // only left half
  const card=state.playerDeck[state.selectedIndex];
  state.preview={x,y,card};
});
canvas.addEventListener("click",e=>{
  if(!state.preview)return;
  const card=state.preview.card;
  if(state.elixir<card.cost){log("Not enough elixir.");return;}
  // snap Y to nearest lane
  const laneY=Math.abs(state.preview.y-CONFIG.laneY.top)<Math.abs(state.preview.y-CONFIG.laneY.bottom)?CONFIG.laneY.top:CONFIG.laneY.bottom;
  state.entities.push({id:uid(),...card,x:state.preview.x,y:laneY,owner:"player",hp:card.hp});
  state.elixir-=card.cost;
  // cycle card
  const used=state.playerDeck.splice(state.selectedIndex,1)[0];
  state.playerDeck.push({...used,uid:uid()});
  state.selectedIndex=null;state.preview=null;renderHand();
});

/* --- Game loop --- */
function loop(t){
  if(!state.running)return;
  const dt=t-state.lastFrame;state.lastFrame=t;state.time+=dt;
  // elixir regen
  const interval=state.time>=CONFIG.elixir.doubleAfter?CONFIG.elixir.doubleInterval:CONFIG.elixir.interval;
  state.elixirTick+=dt;while(state.elixirTick>=interval){state.elixirTick-=interval;if(state.elixir<CONFIG.elixir.max)state.elixir++;}
  elixirFill.style.width=(state.elixir/CONFIG.elixir.max*100)+"%";
  render();
  requestAnimationFrame(loop);
}

/* --- Render --- */
function render(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle=CONFIG.lane;ctx.fillRect(0,CONFIG.laneY.top-70,canvas.width,120);
  ctx.fillRect(0,CONFIG.laneY.bottom-70,canvas.width,120);
  // towers
  [...state.playerTowers,...state.cpuTowers].forEach(t=>{
    ctx.fillStyle=t.owner==="player"?"#3cb371":"#d9534f";
    ctx.beginPath();ctx.arc(t.x,t.y,CONFIG.towerR,0,Math.PI*2);ctx.fill();
    ctx.fillStyle="#000";ctx.font="10px sans-serif";ctx.fillText(t.king?"King":"Crown",t.x-14,t.y+38);
  });
  // units
  state.entities.forEach(u=>{
    ctx.fillStyle=u.owner==="player"?"#2b8f6a":"#b33a3a";
    ctx.beginPath();ctx.arc(u.x,u.y,10,0,Math.PI*2);ctx.fill();
  });
  // preview circle
  if(state.preview){
    const {x,y,card}=state.preview;
    ctx.strokeStyle="rgba(255,255,0,0.6)";
    ctx.beginPath();ctx.arc(x,y,card.range||20,0,Math.PI*2);ctx.stroke();
    ctx.fillStyle="rgba(255,255,0,0.2)";
    ctx.beginPath();ctx.arc(x,y,10,0,Math.PI*2);ctx.fill();
  }
}

/* --- Logging --- */
function log(txt){const d=document.createElement("div");d.textContent=txt;logEl.prepend(d)}

init();
</script>
</body>
</html>
